version: 2.1

executors:
  build-executor:
    docker:
      - image: lineageos4microg/docker-lineage-cicd:latest

jobs:
  build:
    executor: build-executor
    steps:
      - checkout
      - setup_environment
      - run:
          name: Configure git user
          command: |
              git config --global user.email "you@example.com"
              git config --global user.name "Your Name"
      - sync_repositories
      - build_lineageos

commands:
  setup_environment:
    steps:
      - run: echo 'export TARGET_DEVICE=a7y18lte' >> $BASH_ENV

  sync_repositories:
    steps:
      - run: |
          mkdir -p ~/lineage/src
          cd ~/lineage/src
          repo init -u https://github.com/LineageOS/android.git -b lineage-18.0
          git clone https://github.com/LineageOS/android_hardware_samsung.git -b lineage-18.0 hardware/samsung
          git clone https://github.com/LineageOS/android_hardware_samsung_slsi_libbt.git -b lineage-18.0 hardware/samsung_slsi/libbt
          git clone https://github.com/LineageOS/android_hardware_samsung_slsi_scsc_wifibt_wifi_hal.git -b lineage-18.0 hardware/samsung_slsi/scsc_wifibt/wifi_hal
          git clone https://github.com/LineageOS/android_hardware_samsung_slsi_scsc_wifibt_wpa_supplicant_lib.git -b lineage-18.0 hardware/samsung_slsi/scsc_wifibt/wpa_supplicant_lib
          git clone https://github.com/exynos7885-dev/android_device_samsung_exynos7885-common.git -b lineage-18.0 device/samsung/a7y18lte
          repo sync -c -j$(nproc --all) --force-sync --no-clone-bundle --no-tags

  build_lineageos:
    steps:
      - run: |
          cd ~/lineage/src
          source build/envsetup.sh
          lunch lineage_a7y18lte-userdebug
          m -j$(nproc) bacon

workflows:
  version: 2
  build-lineage:
    jobs:
      - build
